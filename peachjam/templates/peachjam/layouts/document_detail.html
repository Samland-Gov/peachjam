{% extends 'peachjam/layouts/main.html' %}
{% load peachjam i18n %}

{% block title %}{{ document.title }}{% endblock %}

{% block page-content %}
  <main class="pb-5">
    <div class="container">
      {% block breadcrumbs %}
      {% endblock %}

      {% block document-title %}
        <h1 class="mb-4 mt-2">{{ document.title }}</h1>
      {% endblock %}

      <div class="mb-5">
        <div class="card">
          <div class="card-body">
            {% block document-metadata %}
              <div class="row">
                <div class="col-md-6">
                  {% block document-metadata-content %}
                    <dl class="row document-metadata-list">

                      {% block document-metadata-content-jurisdiction %}
                        {% if document.jurisdiction %}
                          <dt class="col-4">{% trans 'Jurisdiction' %}</dt>
                          <dd class="col-8 text-muted">{{ document.jurisdiction }} {% if document.locality %} Â· {{ document.locality }}</dd>{% endif %}
                        {% endif %}
                      {% endblock %}

                      {% block document-metadata-content-author %}
                        {% if document.author %}
                          <dt class="col-4">{% trans 'Author' %}</dt>
                          <dd class="col-8 text-muted">{{ document.author }}</dd>
                        {% endif %}
                      {% endblock %}

                      {% block document-metadata-content-date %}
                        <dt class="col-4">{% trans 'Date' %}</dt>
                        {% if date_versions %}
                          <dd class="col-8">
                            <div class="dropdown">
                              <a class="btn btn-outline-secondary btn-sm dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                                {{ document.date }}
                              </a>
                              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                {% for version in date_versions %}
                                  <li><a class="dropdown-item" href="{{ version.get_absolute_url }}">{{ version.date }}</a></li>
                                {% endfor %}
                              </ul>
                            </div>
                          </dd>
                        {% else %}
                          <dd class="col-8 text-muted">{{ document.date }}</dd>
                        {% endif %}
                      {% endblock %}

                      {% block document-metadata-content-language %}
                        <dt class="col-4">{% translate 'Language' %}</dt>
                        {% if language_versions %}
                          <dd class="col-8">
                            <div class="dropdown">
                              <a class="btn btn-outline-secondary btn-sm dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                                {{ document.language }}
                              </a>
                              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                {% for version in language_versions %}
                                  <li><a class="dropdown-item" href="{{ version.get_absolute_url }}">{{ version.language }}</a></li>
                                {% endfor %}
                              </ul>
                            </div>
                          </dd>
                        {% else %}
                          <dd class="col-8 text-muted">{{ document.language }} </dd>
                        {% endif %}
                      {% endblock %}
                    </dl>
                  {% endblock %}

                  {% if document.source_file %}
                    <div>
                      <a
                        class="card-link" href="{% url 'document_source' document.expression_frbr_uri|strip_first_character %}"
                      >{% trans "Download" %} {{ document.source_file.filename_extension|upper }}</a>
                      ({{ document.source_file.size|filesizeformat }})
                    </div>
                  {% endif %}
                </div>

                <div class="col-md-6">
                  {% block document-relationships-content %}
                    {% if document.relationships_as_subject or document.relationships_as_object %}
                      <h5>{% translate 'Related documents' %}</h5>

                      <ul class="list-unstyled">
                        {% for rel in document.relationships_as_subject %}
                          {% if rel.object_document %}
                            <li>
                              {% translate rel.predicate.verb as verb %}
                              {{ verb|capfirst }}
                              <a href="{% url 'document_detail' frbr_uri=rel.object_document.expression_frbr_uri|strip_first_character %}">{{ rel.object_document.title }}</a>
                            </li>
                          {% endif %}
                        {% endfor %}

                        {% for rel in document.relationships_as_object %}
                          {% if rel.subject_document %}
                            <li>
                              {% translate rel.predicate.reverse_verb as verb %}
                              {{ verb|capfirst }}
                              <a href="{% url 'document_detail' frbr_uri=rel.subject_document.expression_frbr_uri|strip_first_character %}">{{ rel.subject_document.title }}</a>
                            </li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                    {% endif %}
                  {% endblock %}
                </div>
              </div>
            {% endblock %}

            {% if perms.peachjam.change_coredocument %}
              <a href="{{ document|admin_url:'change' }}">Edit document</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      {% block content %}
        {% include 'peachjam/_document_content.html' with document=document %}
      {% endblock %}
    </div>
  </main>

  {% if perms.peachjam.add_relationship %}
    {{ predicates_json|json_script:"predicates" }}
  {% endif %}
  {{ citation_links|json_script:"citation-links" }}
  {{ provision_relationships|json_script:"provision-relationships" }}
{% endblock %}
